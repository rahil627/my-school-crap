C:\Documents and Settings\amr\Desktop\MiniIDE\lcd_test.lst - generated by MGTEK Assembler ASM11 V1.21 Build 129 for WIN32 (x86) - Mon Mar 15 10:57:02 2004

    1:                                 ; Wookie LCD Test
    2:                                 ;
    3:                                 
    4:          =00001007              ddrc    equ 0x1007        ;data direction register for C
    5:          =00001002              pioc    equ 0x1002        ;for strobe B assertion change
    6:          =00001005              portcl  equ 0x1005        ;port C latched
    7:          =00001004              portb   equ 0x1004        ;port B
    8:                                 
    9:          =0000C000                      ORG $C000
   10:     C000                        write_string:
   11:                                 
   12:     C000 8E 01FF                        lds  #$01FF     ;initialise stack pointer value
   13:     C003 86 FF                          ldaa #0xFF      ;set for output
   14:     C005 B7 1007                        staa ddrc       ;C output
   15:     C008 B6 1002                        ldaa pioc       ;get current value
   16:     C00B 84 FE                          anda #0xFE      ;reset bit 0 to 0
   17:     C00D B7 1002                        staa pioc       ;send it out
   18:                                 
   19:     C010 CE C058                        ldx  #string    ;get the string address
   20:     C013 C6 04                          ldab #0x4       ;position value
   21:                                 
   22:     C015 A6 00                  print:   ldaa 0,x        ;get a value
   23:     C017 81 00                          cmpa #0         ;is it a null?
   24:     C019 27 3B                          beq  end        ;done
   25:     C01B C1 00                          cmpb #0         ;off the end?
   26:     C01D 26 0A                          bne  ok
   27:     C01F C6 04                          ldab #0x4       ;reset to 4
   28:     C021 09                             dex
   29:     C022 09                             dex
   30:     C023 09                             dex             ;move pointer back
   31:     C024 BD C033                        jsr  wait
   32:     C027 20 EC                          bra  print      ;keep going
   33:                                 
   34:     C029 5A                     ok:      decb            ;position = position - 1
   35:     C02A F7 1005                        stab portcl     ;set the position 
   36:     C02D B7 1004                        staa portb      ;set the character
   37:     C030 08                             inx             ;point to next one
   38:     C031 20 E2                          bra  print      ;keep going
   39:                                 
   40:                                 ; subroutine wait
   41:                                 ; waits 250 ms
   42:                                 ; modifies nothing
   43:     C033 36                     wait:    psha            ;save A
   44:     C034 07                             tpa             ;save condition codes
   45:     C035 36                             psha
   46:     C036 3C                             pshx
   47:     C037 CE 00FA                        ldx #250        ;wait 250 milliseconds
   48:     C03A BD C045                1$:      jsr wait1ms     ;local label
   49:     C03D 09                             dex
   50:     C03E 26 FA                          bne 1$
   51:     C040 38                             pulx
   52:     C041 32                             pula
   53:     C042 06                             tap
   54:     C043 32                             pula
   55:     C044 39                             rts
   56:                                 
   57:     C045 36                     wait1ms: psha            ;1 ms wait
   58:     C046 07                             tpa
   59:     C047 36                             psha
   60:     C048 3C                             pshx
   61:     C049 CE 00C8                        ldx #200
   62:     C04C 09                     2$:      dex
   63:     C04D 01                             nop
   64:     C04E 01                             nop
   65:     C04F 26 FB                          bne 2$
   66:     C051 38                             pulx
   67:     C052 32                             pula
   68:     C053 06                             tap
   69:     C054 32                             pula
   70:     C055 39                             rts
   71:                                 
   72:     C056 20 FE                  end:   bra end
   73:                                 
   74:                                 ;
   75:                                 ;data here
   76:                                 ;
   77:     C058 20 20 20 20 48 45      string: dc.b "    HELLO, IT WORKS!",0       ;null terminated string
           C05E 4C 4C 4F 2C 20 49 
           C064 54 20 57 4F 52 4B 
           C06A 53 21 00 
   78:                                 
   79:                                 
   80:                                 

Symbols:
ddrc                            *00001007
end                             *0000c056
ok                              *0000c029
pioc                            *00001002
portb                           *00001004
portcl                          *00001005
print                           *0000c015
string                          *0000c058
wait                            *0000c033
wait1ms                         *0000c045

