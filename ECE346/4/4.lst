C:\Documents and Settings\Rahil\My Documents\My School\ECE346\4\4.lst - generated by MGTEK Assembler ASM11 V1.26 Build 144 for WIN32 (x86) - Wed Apr 15 09:36:06 2009

    1:                                 *LCD Test code
    2:                                 * Change History
    3:                                 * 4/01/03  Created by James M. Mengert
    4:                                 * 3/30/04  Modified by Dr. Lee Belfore
    5:                                 *          Arrays accessed from low to high addresses
    6:                                 *          Comments added, Orgs changed, 
    7:                                 *          index off of REGBAS
    8:                                 
    9:          =00000000              DATA    EQU $0000
   10:                                 *MAIN    EQU $B700  ;From EPROM
   11:          =00000100              MAIN    EQU $0100  ;From RAM
   12:                                 
   13:                                 * Equates for the LCD display
   14:                                 *    be sure to configure EVBU board for 
   15:                                 *    expanded mode
   16:          =0000B5F0              COMBASE EQU $B5F0
   17:          =0000B5F1              DATBASE EQU $B5F1
   18:          =00001000              REGBAS   EQU $1000
   19:          =00000018              TOC2     EQU $18
   20:          =00000022              TMSK1    EQU $22
   21:          =00000023              TFLG1    EQU $23
   22:          =0000000E              TCNT     EQU $0E
   23:          =00001039              OPTION  EQU     $1039
   24:          =00001030              ADCTL   EQU     $1030
   25:          =00001031              ADR1    EQU     $1031
   26:          =00001032              ADR2    EQU     $1032
   27:          =00001033              ADR3    EQU     $1033
   28:          =00001034              ADR4    EQU     $1034
   29:          =0000FFB8              OUTA    EQU     $FFB8
   30:          =00001000              PORTA   EQU     $1000
   31:                                 
   32:          =00000040              OC2F     EQU %01000000
   33:          =00000040              OC2I     EQU %01000000
   34:          =00000004              INIT_LEN EQU $04   ;actually len-1
   35:          =00000007              DATA_LEN EQU $07   ;actually len-1
   36:          =00000003              DATA_LEN2 EQU $03
   37:          =00000000              CONT_LEN EQU $00
   38:          =000007D0              T_BASE   EQU 2000  ; 1 ms
   39:          =00000004              D_COUNT  EQU 4
   40:          =000000DC              OC2_VEC  EQU $DC
   41:                                         
   42:                                 
   43:          =00000000                       ORG DATA
   44:     0000 38                     INIT_DATA   FCB $38             ; function set
   45:     0001 38                                 FCB $38             ; function set
   46:     0002 06                                 FCB $06             ; Entry mode set
   47:     0003 01                                 FCB $01             ; Clear display
   48:     0004 0F                                 FCB $0F             ; Display On/Off control
   49:                                 
   50:     0005 80                     CONT1       FCB $80    ; DD RAM Address Set to 000 0000
   51:                                 
   52:     0006 C0                     CONT2       FCB $C0    ; DD RAM Address Set to 100 0000
   53:                                 
   54:                                 * Note the LCD data takes ASCII input directly
   55:                                 *DATA1       FCC 'Microcontrollers'
   56:     0007 50 61 75 73 65 20      DATA1       FCC 'Pause   '
           000D 20 20 
   57:     000F 55 70 2F 44 6F 77      DATA2       FCC 'Up/Down '
           0015 6E 20 
   58:     0017 52 65 73 65 74 20      DATA3       FCC 'Reset   '
           001D 20 20 
   59:     001F 4D 6F 64 65 20 20      DATA4       FCC 'Mode    '
           0025 20 20 
   60:     0027 20 20 20 20 20 20      DATA5       FCC '        '
           002D 20 20 
   61:                                 
   62:     002F +0001                  CNTR     RMB 1
   63:                                 
   64:                                 *
   65:          =00000100                      ORG MAIN
   66:                                 *JUMP TABLE INITIALIZATION
   67:     0100 86 7E                          LDAA    #$7E          ;SET UP OC2 JUMP TABLE
   68:     0102 97 DC                          STAA    OC2_VEC       ;FOR JMP
   69:     0104 CC 01E7                        LDD     #OC2_SVC      ;TO
   70:     0107 DD DD                          STD     OC2_VEC+1     ;OC2 INTERRUPT SERVICE
   71:                                 *TOC2 INITIALIZATION
   72:     0109 FC 100E                        LDD     REGBAS+TCNT
   73:     010C FD 1018                        STD     REGBAS+TOC2
   74:                                 *OC2 INTERRUPT INITIALIZATION        
   75:     010F 86 40                          LDAA    #OC2I         ;SET UP OC2 INTERRUPT
   76:     0111 B7 1022                        STAA    REGBAS+TMSK1  ;ENABLE OC2 IN MASK REGISTER
   77:     0114 86 40                          LDAA    #OC2F         ;SET UP TO CLEAR
   78:     0116 B7 1023                        STAA    REGBAS+TFLG1  ;OC3  INTERRUPT FLAG
   79:     0119 0E                             CLI                   ;ENABLE SYSTEM INTERRUPT
   80:                                 
   81:     011A B6 1039                        LDAA    OPTION
   82:     011D 9A 80                          ORAA    %10000000       ;Power up A2D
   83:     011F B7 1039                        STAA    OPTION
   84:                                 
   85:     0122 86 23                          LDAA    #%00100011      ;use PE_3 as the a2d input
   86:     0124 B7 1030                        STAA    ADCTL           ;clear CCF, set channel to begin conversion
   87:                                 
   88:                                 
   89:                                 * LCD initialization sequence
   90:     0127 C6 04                          LDAB    #INIT_LEN 
   91:     0129 CE 0000                        LDX     #INIT_DATA
   92:     012C A6 00                  M1      LDAA    0,X
   93:     012E B7 B5F0                        STAA    COMBASE
   94:     0131 86 04                          LDAA    #D_COUNT
   95:     0133 97 2F                          STAA    CNTR
   96:     0135 96 2F                  LOOP1   LDAA    CNTR          ; 4ms delay
   97:     0137 26 FC                          BNE     LOOP1
   98:     0139 08                             INX
   99:     013A 5A                             DECB
  100:     013B 2C EF                          BGE     M1
  101:                                 
  102:     013D B6 1000                BEGIN   LDAA    PORTA
  103:                                         ;JSR    OUTA
  104:     0140 81 89                          CMPA    #$89
  105:     0142 27 02                          BEQ     QUIT
  106:     0144 20 01                          BRA     CHECK
  107:                                 
  108:     0146 3F                     QUIT    SWI
  109:                                 
  110:     0147 B6 1031                CHECK   LDAA    ADR1
  111:     014A 81 55                          CMPA    #$55
  112:     014C 25 06                          BLO     DISP1
  113:     014E 81 AB                          CMPA    #$AB
  114:     0150 25 27                          BLO     DISP2
  115:     0152 20 4A                          BRA     DISP3
  116:                                 
  117:                                 *DISP1  LDAA    #DATA1
  118:                                 *       STAA    DATA5
  119:                                 *       BRA     LCDGO
  120:                                 *DISP2  LDAA    #DATA2
  121:                                 *       STAA    DATA5
  122:                                 *       BRA     LCDGO
  123:                                 *DISP3  LDAA    #DATA3
  124:                                 *       STAA    DATA5
  125:                                 
  126:                                 * Display the pause position
  127:     0154 96 05                  DISP1   LDAA    CONT1
  128:     0156 B7 B5F0                        STAA    COMBASE
  129:     0159 86 04                          LDAA    #D_COUNT
  130:     015B 97 2F                          STAA    CNTR
  131:     015D 96 2F                  LOOPC1  LDAA    CNTR          ; 4ms delay
  132:     015F 26 FC                          BNE     LOOPC1
  133:                                 * Output first 8 characters       
  134:     0161 C6 07                          LDAB    #DATA_LEN
  135:     0163 CE 0007                        LDX     #DATA1
  136:     0166 A6 00                  M2      LDAA    0,X
  137:     0168 B7 B5F1                        STAA    DATBASE
  138:     016B 86 04                          LDAA    #D_COUNT
  139:     016D 97 2F                          STAA    CNTR
  140:     016F 96 2F                  LOOP2   LDAA    CNTR                ; 4ms delay
  141:     0171 26 FC                          BNE     LOOP2
  142:     0173 08                             INX
  143:     0174 5A                             DECB
  144:     0175 2C EF                          BGE     M2
  145:     0177 20 48                          BRA     DISP4
  146:                                 
  147:                                 * Display the up/down position
  148:     0179 96 05                  DISP2   LDAA    CONT1
  149:     017B B7 B5F0                        STAA    COMBASE
  150:     017E 86 04                          LDAA    #D_COUNT
  151:     0180 97 2F                          STAA    CNTR
  152:     0182 96 2F                  LOOPC2  LDAA    CNTR          ; 4ms delay
  153:     0184 26 FC                          BNE     LOOPC2
  154:                                 * Output first 8 characters       
  155:     0186 C6 07                          LDAB    #DATA_LEN
  156:     0188 CE 000F                        LDX     #DATA2
  157:     018B A6 00                  M3      LDAA    0,X
  158:     018D B7 B5F1                        STAA    DATBASE
  159:     0190 86 04                          LDAA    #D_COUNT
  160:     0192 97 2F                          STAA    CNTR
  161:     0194 96 2F                  LOOP3   LDAA    CNTR                ; 4ms delay
  162:     0196 26 FC                          BNE     LOOP3
  163:     0198 08                             INX
  164:     0199 5A                             DECB
  165:     019A 2C EF                          BGE     M3
  166:     019C 20 23                          BRA     DISP4
  167:                                 
  168:                                 * Display the reset position
  169:     019E 96 05                  DISP3   LDAA    CONT1
  170:     01A0 B7 B5F0                        STAA    COMBASE
  171:     01A3 86 04                          LDAA    #D_COUNT
  172:     01A5 97 2F                          STAA    CNTR
  173:     01A7 96 2F                  LOOPC3  LDAA    CNTR          ; 4ms delay
  174:     01A9 26 FC                          BNE     LOOPC3
  175:                                 * Output first 8 characters       
  176:     01AB C6 07                          LDAB    #DATA_LEN
  177:     01AD CE 0017                        LDX     #DATA3
  178:     01B0 A6 00                  M4      LDAA    0,X
  179:     01B2 B7 B5F1                        STAA    DATBASE
  180:     01B5 86 04                          LDAA    #D_COUNT
  181:     01B7 97 2F                          STAA    CNTR
  182:     01B9 96 2F                  LOOP4   LDAA    CNTR                ; 4ms delay
  183:     01BB 26 FC                          BNE     LOOP4
  184:     01BD 08                             INX
  185:     01BE 5A                             DECB
  186:     01BF 2C EF                          BGE     M4
  187:                                 
  188:                                 * Display mode at the bottom
  189:     01C1 96 06                  DISP4   LDAA    CONT2
  190:     01C3 B7 B5F0                        STAA    COMBASE
  191:                                 
  192:     01C6 86 04                          LDAA    #D_COUNT
  193:     01C8 97 2F                          STAA    CNTR
  194:     01CA 96 2F                  LOOPC4  LDAA    CNTR                ; 4ms delay
  195:     01CC 26 FC                          BNE     LOOPC4
  196:                                 
  197:                                 * Output second 8 characters
  198:                                 
  199:     01CE C6 07                          LDAB  #DATA_LEN
  200:     01D0 CE 001F                        LDX   #DATA4
  201:     01D3 A6 00                  M5      LDAA  0,X
  202:     01D5 B7 B5F1                        STAA  DATBASE
  203:     01D8 86 04                          LDAA  #D_COUNT
  204:     01DA 97 2F                          STAA  CNTR
  205:     01DC 96 2F                  LOOP5   LDAA  CNTR                ; 4ms delay
  206:     01DE 26 FC                          BNE   LOOP5
  207:     01E0 08                             INX
  208:     01E1 5A                             DECB 
  209:     01E2 2C EF                          BGE   M5
  210:     01E4 BD 013D                        JSR     BEGIN
  211:                                         ;SWI                ; return to Buffalo
  212:                                 
  213:                                 
  214:                                 *
  215:                                 *       OC2 INTERRUPT SERVICE ROUTINE
  216:                                 *       INTERRUPTS EVERY 1 MS AND DECREMENTS A COUNTER
  217:                                 *       PROVIDES A TIME BASE EVENT EVERY 1 MS
  218:                                 *        
  219:                                 *        
  220:     01E7 86 40                  OC2_SVC LDAA  #OC2F          ;SET UP TO 
  221:     01E9 B7 1023                        STAA  REGBAS+TFLG1   ;CLEAR OC2F
  222:     01EC FC 1018                        LDD   REGBAS+TOC2    ;SET UP FOR NEXT INTERRUPT
  223:     01EF C3 07D0                        ADDD  #T_BASE        ;ADD TIMEBASE (1 MS)
  224:     01F2 FD 1018                        STD   REGBAS+TOC2    ;AND STORE 
  225:     01F5 7A 002F                        DEC   CNTR           ;DEC TIME BASE COUNTER
  226:     01F8 3B                             RTI                  ;EXIT
  227:                                 
  228:                                 

Symbols:
adctl                           *00001030
adr1                            *00001031
begin                           *0000013d
check                           *00000147
cntr                            *0000002f
combase                         *0000b5f0
cont1                           *00000005
cont2                           *00000006
d_count                         *00000004
data                            *00000000
data1                           *00000007
data2                           *0000000f
data3                           *00000017
data4                           *0000001f
data_len                        *00000007
datbase                         *0000b5f1
disp1                           *00000154
disp2                           *00000179
disp3                           *0000019e
disp4                           *000001c1
init_data                       *00000000
init_len                        *00000004
loop1                           *00000135
loop2                           *0000016f
loop3                           *00000194
loop4                           *000001b9
loop5                           *000001dc
loopc1                          *0000015d
loopc2                          *00000182
loopc3                          *000001a7
loopc4                          *000001ca
m1                              *0000012c
m2                              *00000166
m3                              *0000018b
m4                              *000001b0
m5                              *000001d3
main                            *00000100
oc2_svc                         *000001e7
oc2_vec                         *000000dc
oc2f                            *00000040
oc2i                            *00000040
option                          *00001039
porta                           *00001000
quit                            *00000146
regbas                          *00001000
t_base                          *000007d0
tcnt                            *0000000e
tflg1                           *00000023
tmsk1                           *00000022
toc2                            *00000018

