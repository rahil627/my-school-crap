C:\Documents and Settings\Rahil\My Documents\My School\ECE346\4\LCDTest.lst - generated by MGTEK Assembler ASM11 V1.26 Build 144 for WIN32 (x86) - Sat Apr 11 00:34:40 2009

    1:                                 *LCD Test code
    2:                                 * Change History
    3:                                 * 4/01/03  Created by James M. Mengert
    4:                                 * 3/30/04  Modified by Dr. Lee Belfore
    5:                                 *          Arrays accessed from low to high addresses
    6:                                 *          Comments added, Orgs changed, 
    7:                                 *          index off of REGBAS
    8:                                 
    9:          =00000000              DATA    EQU $0000
   10:                                 *MAIN    EQU $B700  ;From EPROM
   11:          =00000100              MAIN    EQU $0100  ;From RAM
   12:                                 
   13:                                 * Equates for the LCD display
   14:                                 *    be sure to configure EVBU board for 
   15:                                 *    expanded mode
   16:          =0000B5F0              COMBASE EQU $B5F0
   17:          =0000B5F1              DATBASE EQU $B5F1
   18:          =00001000              REGBAS   EQU $1000
   19:          =00000018              TOC2     EQU $18
   20:          =00000022              TMSK1    EQU $22
   21:          =00000023              TFLG1    EQU $23
   22:          =0000000E              TCNT     EQU $0E
   23:                                 
   24:          =00000040              OC2F     EQU %01000000
   25:          =00000040              OC2I     EQU %01000000
   26:          =00000004              INIT_LEN EQU $04   ;actually len-1
   27:          =00000007              DATA_LEN EQU $07   ;actually len-1
   28:          =00000000              CONT_LEN EQU $00
   29:          =000007D0              T_BASE   EQU 2000  ; 1 ms
   30:          =00000004              D_COUNT  EQU 4
   31:          =000000DC              OC2_VEC  EQU $DC
   32:                                         
   33:                                 *
   34:          =00000000                       ORG DATA
   35:     0000 38                     INIT_DATA   FCB $38             ; function set
   36:     0001 38                                 FCB $38             ; function set
   37:     0002 06                                 FCB $06             ; Entry mode set
   38:     0003 01                                 FCB $01             ; Clear display
   39:     0004 0F                                 FCB $0F             ; Display On/Off control
   40:                                 
   41:     0005 80                     CONT1       FCB $80    ; DD RAM Address Set to 000 0000
   42:                                 
   43:     0006 C0                     CONT2       FCB $C0    ; DD RAM Address Set to 100 0000
   44:                                 
   45:                                 * Note the LCD data takes ASCII input directly
   46:     0007 4D                     DATA1       FCB 'M'
   47:     0008 69                                 FCB 'i'
   48:     0009 63                                 FCB 'c'
   49:     000A 72                                 FCB 'r'
   50:     000B 6F                                 FCB 'o'
   51:     000C 63                                 FCB 'c'
   52:     000D 6F                                 FCB 'o'
   53:     000E 6E                                 FCB 'n'
   54:                                 
   55:     000F 74                     DATA2       FCB 't'
   56:     0010 72                                 FCB 'r'
   57:     0011 6F                                 FCB 'o'
   58:     0012 6C                                 FCB 'l'
   59:     0013 6C                                 FCB 'l'
   60:     0014 65                                 FCB 'e'
   61:     0015 72                                 FCB 'r'
   62:     0016 73                                 FCB 's'
   63:                                 
   64:     0017 +0001                  CNTR     RMB 1
   65:                                 *
   66:          =00000100                      ORG MAIN
   67:                                 *JUMP TABLE INITIALIZATION
   68:     0100 86 7E                          LDAA    #$7E          ;SET UP OC2 JUMP TABLE
   69:     0102 97 DC                          STAA    OC2_VEC       ;FOR JMP
   70:     0104 CC 0177                        LDD     #OC2_SVC      ;TO
   71:     0107 DD DD                          STD     OC2_VEC+1     ;OC2 INTERRUPT SERVICE
   72:                                 *TOC2 INITIALIZATION
   73:     0109 FC 100E                        LDD     REGBAS+TCNT
   74:     010C FD 1018                        STD     REGBAS+TOC2
   75:                                 *OC2 INTERRUPT INITIALIZATION        
   76:     010F 86 40                          LDAA    #OC2I         ;SET UP OC2 INTERRUPT
   77:     0111 B7 1022                        STAA    REGBAS+TMSK1  ;ENABLE OC2 IN MASK REGISTER
   78:     0114 86 40                          LDAA    #OC2F         ;SET UP TO CLEAR
   79:     0116 B7 1023                        STAA    REGBAS+TFLG1  ;OC3  INTERRUPT FLAG
   80:     0119 0E                             CLI                   ;ENABLE SYSTEM INTERRUPT
   81:                                 
   82:                                 
   83:                                 
   84:                                 * LCD initialization sequence
   85:     011A C6 04                          LDAB    #INIT_LEN 
   86:     011C CE 0000                        LDX     #INIT_DATA
   87:     011F A6 00                  M1      LDAA    0,X
   88:     0121 B7 B5F0                        STAA    COMBASE
   89:     0124 86 04                          LDAA    #D_COUNT
   90:     0126 97 17                          STAA    CNTR
   91:     0128 96 17                  LOOP1   LDAA    CNTR          ; 4ms delay
   92:     012A 26 FC                          BNE     LOOP1
   93:     012C 08                             INX
   94:     012D 5A                             DECB
   95:     012E 2C EF                          BGE     M1
   96:                                 * Display in first 8 display positions
   97:     0130 96 05                          LDAA    CONT1
   98:     0132 B7 B5F0                        STAA    COMBASE
   99:     0135 86 04                          LDAA    #D_COUNT
  100:     0137 97 17                          STAA    CNTR
  101:     0139 96 17                  LOOPC1  LDAA    CNTR          ; 4ms delay
  102:     013B 26 FC                          BNE     LOOPC1
  103:                                 * Output first 8 characters       
  104:     013D C6 07                          LDAB    #DATA_LEN
  105:     013F CE 0007                        LDX     #DATA1
  106:     0142 A6 00                  M2      LDAA    0,X
  107:     0144 B7 B5F1                        STAA    DATBASE
  108:     0147 86 04                          LDAA    #D_COUNT
  109:     0149 97 17                          STAA    CNTR
  110:     014B 96 17                  LOOP2   LDAA    CNTR                ; 4ms delay
  111:     014D 26 FC                          BNE     LOOP2
  112:     014F 08                               INX
  113:     0150 5A                             DECB
  114:     0151 2C EF                          BGE     M2
  115:                                 * Display in second 8 display positions
  116:     0153 96 06                          LDAA    CONT2
  117:     0155 B7 B5F0                        STAA    COMBASE
  118:     0158 86 04                          LDAA    #D_COUNT
  119:     015A 97 17                          STAA    CNTR
  120:     015C 96 17                  LOOPC2  LDAA    CNTR                ; 4ms delay
  121:     015E 26 FC                          BNE     LOOPC2
  122:                                 * Output second 8 characters
  123:     0160 C6 07                          LDAB  #DATA_LEN
  124:     0162 CE 000F                        LDX   #DATA2
  125:     0165 A6 00                  M4      LDAA  0,X
  126:     0167 B7 B5F1                        STAA  DATBASE
  127:     016A 86 04                          LDAA  #D_COUNT
  128:     016C 97 17                          STAA  CNTR
  129:     016E 96 17                  LOOP4   LDAA  CNTR                ; 4ms delay
  130:     0170 26 FC                          BNE   LOOP4
  131:     0172 08                             INX
  132:     0173 5A                             DECB 
  133:     0174 2C EF                          BGE   M4
  134:     0176 3F                             SWI                ; return to Buffalo
  135:                                 
  136:                                 
  137:                                 *
  138:                                 *       OC2 INTERRUPT SERVICE ROUTINE
  139:                                 *       INTERRUPTS EVERY 1 MS AND DECREMENTS A COUNTER
  140:                                 *       PROVIDES A TIME BASE EVENT EVERY 1 MS
  141:                                 *        
  142:                                 *        
  143:     0177 86 40                  OC2_SVC LDAA  #OC2F          ;SET UP TO 
  144:     0179 B7 1023                        STAA  REGBAS+TFLG1   ;CLEAR OC2F
  145:     017C FC 1018                        LDD   REGBAS+TOC2    ;SET UP FOR NEXT INTERRUPT
  146:     017F C3 07D0                        ADDD  #T_BASE        ;ADD TIMEBASE (1 MS)
  147:     0182 FD 1018                        STD   REGBAS+TOC2    ;AND STORE 
  148:     0185 7A 0017                        DEC   CNTR           ;DEC TIME BASE COUNTER
  149:     0188 3B                             RTI                  ;EXIT
  150:                                 
  151:                                 

Symbols:
cntr                            *00000017
combase                         *0000b5f0
cont1                           *00000005
cont2                           *00000006
d_count                         *00000004
data                            *00000000
data1                           *00000007
data2                           *0000000f
data_len                        *00000007
datbase                         *0000b5f1
init_data                       *00000000
init_len                        *00000004
loop1                           *00000128
loop2                           *0000014b
loop4                           *0000016e
loopc1                          *00000139
loopc2                          *0000015c
m1                              *0000011f
m2                              *00000142
m4                              *00000165
main                            *00000100
oc2_svc                         *00000177
oc2_vec                         *000000dc
oc2f                            *00000040
oc2i                            *00000040
regbas                          *00001000
t_base                          *000007d0
tcnt                            *0000000e
tflg1                           *00000023
tmsk1                           *00000022
toc2                            *00000018

