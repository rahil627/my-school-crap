C:\Documents and Settings\Rahil\My Documents\My School\ECE346\examples\INT2.lst - generated by MGTEK Assembler ASM11 V1.26 Build 144 for WIN32 (x86) - Sun Mar 01 01:54:27 2009

    1:          =000000D9              OC3_VEC         EQU     $00D9   ; pseudo-vector location for OC3        
    2:          =00000000              DATA            EQU     $0      ; Start of data segment
    3:          =00000100              MAIN            EQU     $100    ; Start of code segment
    4:                                 
    5:          =0000FFB8              OUTA            EQU     $FFB8
    6:          =0000FFCD              INCHAR          EQU     $FFCD
    7:                                 
    8:                                 * 6811 special register definitions
    9:                                 
   10:          =00001003              PORTC           EQU     $1003
   11:          =00001007              DDRC            EQU     $1007
   12:                                 
   13:          =0000100E              TCNT            EQU     $100E   ; Free running counter
   14:                                 
   15:          =0000101A              TOC3            EQU     $101A   ; Output compare register
   16:                                 
   17:          =00001020              TCTL1           EQU     $1020
   18:          =00001022              TMSK1           EQU     $1022
   19:          =00001023              TFLG1           EQU     $1023
   20:                                 
   21:                                 * Masks for manipulating output compare interrupts
   22:          =00000020              OC3F            EQU     %00100000
   23:          =00000020              OC3I            EQU     %00100000
   24:                                 * Some definitions used for time base and pulse width 
   25:                                 
   26:          =00000064              ONE_CNT         EQU     100                ;10 MS * 100 = 1 SEC
   27:          =000000C8              ZERO_CNT        EQU     200        ;10 MS * 200 = 2 SEC
   28:          =00004E20              TIM_BASE        EQU     20000      ;0.5 US *20000 = 10 MS
   29:          =00002710              OFFSET          EQU     10000      ;0.5us *10000 = 5 ms
   30:                                 
   31:          =00000000                      ORG DATA
   32:     0000 +0001                  CNTR    RMB     1                       ;TIME BASE COUNTER (MESSAGE)?
   33:                                         
   34:                                 
   35:          =00000100                      ORG MAIN
   36:                                 
   37:                                 *PORT C INITIALIZATION       
   38:     0100 86 01                          LDAA    #%00000001              ; SET UP PORTC_0 FOR 
   39:     0102 B7 1007                        STAA    DDRC                    ;OUTPUT
   40:     0105 4F                             CLRA                            ;AND 
   41:     0106 B7 1003                        STAA    PORTC                   ;OUTPUT A ZERO
   42:                                 
   43:                                 *---------------- Interrupt initialization ----------------------------
   44:                                 
   45:                                 *JUMP TABLE INITIALIZATION
   46:     0109 86 7E                          LDAA    #$7E                    ;SET UP OC3 JUMP TABLE    
   47:     010B 97 D9                          STAA    OC3_VEC                 ;FOR JMP
   48:     010D CC 0142                        LDD     #OC3_SVC                ; TO
   49:     0110 DD DA                          STD      OC3_VEC+1              ;OC3 INTERRUPT SERVICE
   50:                                 
   51:                                 *OC3 INTERRUPT INITIALIZATION        
   52:     0112 86 20                          LDAA    #OC3I                   ;SET UP OC3 INTERRUPT
   53:     0114 B7 1022                        STAA    TMSK1                   ;ENABLE OC3 IN MASK REGISTER
   54:     0117 86 20                          LDAA    #OC3F                   ;SET UP TO CLEAR
   55:     0119 B7 1023                        STAA    TFLG1                   ;OC3  INTERRUPT FLAG
   56:                                 
   57:                                 *TOC3 INITIALIZATION        
   58:     011C FC 100E                        LDD     TCNT                    ;GET CURRNT VALUE OF TCNT
   59:     011F C3 2710                        ADDD   #OFFSET                  ;ADD 5 MS OFFSET
   60:     0122 FD 101A                        STD     TOC3                    ;SET UP  TOC3
   61:                                 
   62:     0125 0E                             CLI                             ;ENABLE SYSTEM INTERRUPT
   63:                                 *--------------- End Interrupt initialization ------------------------
   64:                                 
   65:                                 
   66:                                 *       TWO STATE MACHINE       
   67:     0126 86 01                  REENTR  LDAA    #%00000001 ;SET UP FOR '1' OUT
   68:     0128 B7 1003                        STAA    PORTC
   69:     012B 86 64                          LDAA    #ONE_CNT   ;SET UP 1 SECOND DELAY 
   70:     012D 97 00                          STAA    CNTR
   71:                                 
   72:     012F 96 00                  LOOP1   LDAA    CNTR       ;CHECK COUNTER  
   73:     0131 26 FC                          BNE     LOOP1      ;WAIT ON ZERO
   74:                                 
   75:     0133 86 00                          LDAA    #%00000000 ;SET UP FOR '0' OUT
   76:     0135 B7 1003                        STAA    PORTC
   77:                                 
   78:     0138 86 C8                          LDAA    #ZERO_CNT  ;SET UP 2 SEC DELAY
   79:     013A 97 00                          STAA    CNTR
   80:                                 
   81:     013C 96 00                  LOOP0   LDAA    CNTR       ;CHECK COUNTER 
   82:     013E 26 FC                          BNE     LOOP0      ;WAIT IF NOT ZERO
   83:     0140 20 E4                          BRA     REENTR     ;ELSE START OVER-ENDLESS LOOP
   84:                                 
   85:                                 
   86:                                 
   87:                                 
   88:                                 * OC3 INTERUPT SERVICE ROUTINE INTERRUPTS EVERY 10 MS AND 
   89:                                 * DECREMENTS A COUNTER PROVIDES A TIME BASE EVENT EVERY 10 MS
   90:                                 *        
   91:     0142 86 20                  OC3_SVC LDAA    #OC3F         ;SET UP TO 
   92:     0144 B7 1023                        STAA    TFLG1         ;CLEAR OC3F
   93:                                 
   94:     0147 FC 101A                        LDD     TOC3          ;SET UP FOR NEXT INTERRUPT
   95:     014A C3 4E20                        ADDD   #TIM_BASE      ;ADD TIMEBASE (10 MS)?
   96:     014D FD 101A                        STD     TOC3          ;AND STORE 
   97:                                 
   98:     0150 86 41                          LDAA    #'A'
   99:     0152 BD FFB8                        JSR     OUTA
  100:     0155 86 0D                          LDAA    #$0D
  101:     0157 BD FFB8                        JSR     OUTA 
  102:                                 
  103:     015A 7A 0000                        DEC     CNTR          ;DEC TIME BASE COUNTER
  104:                                 
  105:     015D 3B                             RTI                   ;EXIT

Symbols:
cntr                            *00000000
data                            *00000000
ddrc                            *00001007
loop0                           *0000013c
loop1                           *0000012f
main                            *00000100
oc3_svc                         *00000142
oc3_vec                         *000000d9
oc3f                            *00000020
oc3i                            *00000020
offset                          *00002710
one_cnt                         *00000064
outa                            *0000ffb8
portc                           *00001003
reentr                          *00000126
tcnt                            *0000100e
tflg1                           *00001023
tim_base                        *00004e20
tmsk1                           *00001022
toc3                            *0000101a
zero_cnt                        *000000c8

